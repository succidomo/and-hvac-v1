# Pin to a specific tag once you know the E+ version you want
FROM nrel/energyplus:latest

USER root

# Install python + pip + your deps
RUN apt-get update && \
    apt-get install -y --no-install-recommends python3 python3-pip && \
    rm -rf /var/lib/apt/lists/*

RUN pip3 install --no-cache-dir numpy

WORKDIR /app

# Your script
COPY run_sim_base.py /app/run_sim_base.py
COPY entrypoint.sh /app/entrypoint.sh
RUN chmod +x /app/entrypoint.sh && sed -i 's/\r$//' /app/entrypoint.sh

# Put required sim assets *inside* the container
RUN mkdir -p /home/guser/weather /home/guser/models /home/guser/results

# Copy the IDF/EPW from build context into the image
COPY eplus_req/weather/ /home/guser/weather/
COPY eplus_req/models/  /home/guser/models/

# (Optional) make sure results dir is writable
RUN chmod -R a+rX /home/guser && chmod -R a+rwX /home/guser/results

ENTRYPOINT ["/app/entrypoint.sh"]
